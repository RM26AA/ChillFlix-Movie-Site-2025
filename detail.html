<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>CHILL - Details</title>
<style>
:root{
  --bg:#141414; --panel:#1c1c1c; --accent:#e50914; --muted:#9a9a9a;
}
*{box-sizing:border-box}
body{margin:0; font-family:Inter, Arial, sans-serif; background:var(--bg); color:#fff;}
header{display:flex; align-items:center; justify-content:space-between; padding:10px 20px; background:#000; position:sticky; top:0; z-index:20; border-bottom:1px solid rgba(255,255,255,0.02);}
.logo{height:40px; cursor:pointer;}
.back{color:#fff; text-decoration:none; font-weight:600; margin-left:12px;}
main{padding:18px 20px 80px;}
.detail-container{display:flex; flex-wrap:wrap; gap:20px; margin-bottom:30px;}
.detail-container img{width:220px; border-radius:8px; flex-shrink:0;}
.detail-info{flex:1; min-width:220px;}
.detail-info h1{margin-top:0; margin-bottom:10px;}
.detail-info p{line-height:1.4; margin-bottom:8px;}
.detail-info span{color:var(--muted);}
.similar-section{margin-top:40px;}
.similar-section h2{margin-bottom:12px;}
.similar-row{display:flex; gap:10px; overflow-x:auto; padding:6px 0;}
.similar-row::-webkit-scrollbar{height:8px;}
.similar-row::-webkit-scrollbar-thumb{background:rgba(255,255,255,0.06); border-radius:8px;}
.similar-card{min-width:140px; max-width:140px; background:var(--panel); border-radius:6px; cursor:pointer; transition:transform .15s; flex:0 0 auto;}
.similar-card:hover{transform:scale(1.05);}
.similar-card img{width:100%; height:210px; object-fit:cover; display:block;}
.similar-card h3{font-size:12px; margin:6px; text-align:center; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;}
.arrow-btn{position:absolute; top:40%; transform:translateY(-50%); background:rgba(0,0,0,0.5); border:0; width:36px; height:56px; display:flex; align-items:center; justify-content:center; cursor:pointer; border-radius:4px;}
.arrow-btn svg{width:18px; height:18px; fill:#fff; opacity:.9;}
.arrow-btn.left{left:4px;}
.arrow-btn.right{right:4px;}
@media(max-width:900px){.detail-container{flex-direction:column;}.detail-container img{width:100%; height:auto;}.similar-card{min-width:120px; max-width:120px;}.similar-card img{height:180px;}}
</style>
</head>
<body>

<header>
  <div style="display:flex;align-items:center;">
    <img src="CHILL1.png" class="logo" id="logoHome" alt="CHILL">
    <a href="index.html" class="back">Home</a>
  </div>
</header>

<main>
  <div id="detail"></div>
  <div class="similar-section">
    <h2>More Like This</h2>
    <div id="similar-row" class="similar-row"></div>
  </div>
</main>

<script>
const API_KEY = '279d55798ba24d36ad0f22f82d9dac49';
const detailEl = document.getElementById('detail');
const similarRow = document.getElementById('similar-row');

// parse query params
function params(){
  const p={};
  location.search.slice(1).split('&').forEach(pair=>{
    if(!pair) return;
    const [k,v]=pair.split('=');
    p[decodeURIComponent(k)]=decodeURIComponent(v||'');
  });
  return p;
}
const qs = params();
const id = qs.id;
const type = qs.type || 'movie'; // default to movie

if(!id){ detailEl.innerHTML='<p>No movie/show selected.</p>'; throw 'No ID'; }

// fetch details
async function fetchDetails(){
  try{
    const url=`https://api.themoviedb.org/3/${type}/${id}?api_key=${API_KEY}&language=en-US`;
    const res = await fetch(url);
    const data = await res.json();

    const title = data.title || data.name || 'Untitled';
    const overview = data.overview || 'No description available.';
    const poster = data.poster_path ? `https://image.tmdb.org/t/p/w500${data.poster_path}` : 'https://via.placeholder.com/500x750?text=No+Image';
    const release = data.release_date || data.first_air_date || 'Unknown';
    const rating = data.vote_average ? data.vote_average.toFixed(1) : 'N/A';
    const genres = data.genres ? data.genres.map(g=>g.name).join(', ') : 'N/A';

    detailEl.innerHTML = `
      <div class="detail-container">
        <img src="${poster}" alt="${title}">
        <div class="detail-info">
          <h1>${title}</h1>
          <p><span>Release:</span> ${release}</p>
          <p><span>Rating:</span> ${rating}/10</p>
          <p><span>Genres:</span> ${genres}</p>
          <p>${overview}</p>
        </div>
      </div>
    `;
  }catch(e){ console.error('fetchDetails error',e); detailEl.innerHTML='<p>Error loading details.</p>'; }
}

// fetch similar
async function fetchSimilar(){
  try{
    const url=`https://api.themoviedb.org/3/${type}/${id}/similar?api_key=${API_KEY}&language=en-US&page=1`;
    const res = await fetch(url);
    const json = await res.json();
    const arr = json.results || [];
    arr.forEach(item=>{
      const title = item.title || item.name || 'Untitled';
      const poster = item.poster_path ? `https://image.tmdb.org/t/p/w500${item.poster_path}` : 'https://via.placeholder.com/500x750?text=No+Image';
      const el = document.createElement('div');
      el.className='similar-card';
      el.innerHTML=`<img src="${poster}" alt="${title}"><h3>${title}</h3>`;
      el.addEventListener('click', ()=>{ window.location.href=`detail.html?id=${item.id}&type=${item.media_type||type}`; });
      similarRow.appendChild(el);
    });
  }catch(e){ console.error('fetchSimilar error',e); }
}

// init
fetchDetails();
fetchSimilar();

// go home
document.getElementById('logoHome').addEventListener('click', ()=>window.location.href='index.html');
</script>

</body>
</html>
